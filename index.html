<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NFC éœ“è™¹å†™å…¥å™¨ // 2077</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- èµ›åšæœ‹å…‹æ ¸å¿ƒæ ·å¼ --- */
    /* æ·»åŠ ä¸­æ–‡å…¼å®¹çš„å­—ä½“æ ˆ */
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

    :root {
      --neon-cyan: #00f3ff;
      --neon-pink: #ff00ff;
      --neon-yellow: #fcee0a;
      --bg-dark: #050505;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--neon-cyan);
      /* ä¼˜å…ˆä½¿ç”¨ç­‰å®½å­—ä½“ï¼Œå›é€€åˆ°ç³»ç»Ÿä¸­æ–‡é»‘ä½“ */
      font-family: 'Share Tech Mono', 'Courier New', 'Microsoft YaHei', 'PingFang SC', monospace;
      background-image:
        linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
      background-size: 20px 20px;
      overflow-x: hidden;
    }

    /* CRT æ‰«æçº¿æ•ˆæœ */
    .scanlines {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to bottom,
          rgba(255, 255, 255, 0),
          rgba(255, 255, 255, 0) 50%,
          rgba(0, 0, 0, 0.2) 50%,
          rgba(0, 0, 0, 0.2));
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 50;
    }

    /* éœ“è™¹å‘å…‰æ–‡å­— */
    .text-glow {
      text-shadow: 0 0 5px var(--neon-cyan), 0 0 10px var(--neon-cyan);
    }

    .text-glow-pink {
      text-shadow: 0 0 5px var(--neon-pink), 0 0 10px var(--neon-pink);
    }

    /* èµ›åšæœ‹å…‹è¾¹æ¡† */
    .cyber-card {
      background: rgba(10, 10, 15, 0.8);
      border: 1px solid var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
      position: relative;
    }

    /* è¾¹è§’è£…é¥° */
    .cyber-card::before {
      content: '';
      position: absolute;
      top: -1px;
      left: -1px;
      width: 10px;
      height: 10px;
      border-top: 2px solid var(--neon-cyan);
      border-left: 2px solid var(--neon-cyan);
    }

    .cyber-card::after {
      content: '';
      position: absolute;
      bottom: -1px;
      right: -1px;
      width: 10px;
      height: 10px;
      border-bottom: 2px solid var(--neon-cyan);
      border-right: 2px solid var(--neon-cyan);
    }

    /* æ•…éšœæ–‡å­—åŠ¨ç”» */
    @keyframes glitch {
      0% {
        transform: translate(0)
      }

      20% {
        transform: translate(-2px, 2px)
      }

      40% {
        transform: translate(-2px, -2px)
      }

      60% {
        transform: translate(2px, 2px)
      }

      80% {
        transform: translate(2px, -2px)
      }

      100% {
        transform: translate(0)
      }
    }

    .glitch-hover:hover {
      animation: glitch 0.2s cubic-bezier(.25, .46, .45, .94) both infinite;
      color: var(--neon-yellow);
    }

    /* æ‰«æå‘¼å¸åŠ¨ç”» */
    @keyframes cyber-pulse {
      0% {
        box-shadow: 0 0 5px var(--neon-yellow);
        border-color: var(--neon-yellow);
      }

      50% {
        box-shadow: 0 0 20px var(--neon-yellow), inset 0 0 10px var(--neon-yellow);
        border-color: #fff;
      }

      100% {
        box-shadow: 0 0 5px var(--neon-yellow);
        border-color: var(--neon-yellow);
      }
    }

    .state-scanning {
      animation: cyber-pulse 1.5s infinite;
    }

    /* æŒ‰é’®åˆ‡è§’ */
    .clip-corner {
      clip-path: polygon(10px 0, 100% 0,
          100% calc(100% - 10px),
          calc(100% - 10px) 100%,
          0 100%,
          0 10px);
    }
  </style>
</head>

<body class="p-4">
  <!-- CRT æ»¤é•œå±‚ -->
  <div class="scanlines"></div>

  <div class="max-w-md mx-auto relative z-10">
    <!-- å¤´éƒ¨ -->
    <header class="mb-8 text-center border-b border-gray-800 pb-4">
      <h1 class="text-4xl font-bold text-white text-glow tracking-tighter">NFC å†™å…¥ç»ˆç«¯<span
                        class="text-pink-500">.EXE</span></h1>
      <div class="text-xs text-gray-400 mt-2 tracking-[0.2em] uppercase">ç³»ç»Ÿ v2.1 // è¯Šæ–­ä¿®å¤ç‰ˆ</div>
    </header>

    <!-- çŠ¶æ€æŒ‡ç¤ºåŒº -->
    <div id="status-card" class="cyber-card p-8 mb-6 text-center transition-all duration-300">
      <div id="status-icon" class="text-6xl mb-4 drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">ğŸ›‘</div>
      <h2 id="status-text" class="text-2xl font-bold mb-2 text-white">ç³»ç»Ÿæ£€æŸ¥ä¸­...</h2>
      <div class="h-1 w-24 mx-auto bg-gray-800 rounded-full overflow-hidden mt-2">
        <div id="loading-bar" class="h-full bg-cyan-400 w-0 transition-all duration-300"></div>
      </div>
      <p id="status-sub" class="text-xs text-cyan-700 mt-3 font-bold uppercase tracking-widest">>>> æ­£åœ¨åˆå§‹åŒ–æ ¸å¿ƒç»„ä»¶</p>
    </div>

    <!-- é…ç½®æ§åˆ¶åŒº -->
    <div class="cyber-card p-6 mb-6">
      <div class="absolute -top-3 left-4 bg-[#050505] px-2 text-xs text-pink-500 border border-pink-500">é…ç½®æ¨¡å—</div>

      <!-- æ•°æ®ç±»å‹é€‰æ‹© -->
      <div class="mb-6">
        <label class="block text-xs text-gray-500 mb-2 uppercase tracking-widest">// æ•°æ®ä¼ è¾“åè®®</label>
        <div class="flex space-x-4">
          <button onclick="setRecordType('text')" id="btn-type-text"
                          class="flex-1 py-2 px-4 border border-cyan-400 text-cyan-400 bg-cyan-900/20 hover:bg-cyan-400 hover:text-black transition-colors font-bold text-sm clip-corner">æ–‡æœ¬æ¨¡å¼</button>
          <button onclick="setRecordType('url')" id="btn-type-url"
                          class="flex-1 py-2 px-4 border border-gray-700 text-gray-500 hover:border-pink-500 hover:text-pink-500 transition-colors font-bold text-sm clip-corner">URL
            é“¾æ¥</button>
        </div>
      </div>

      <!-- æ•°æ®è¾“å…¥ -->
      <div class="mb-6">
        <label class="block text-xs text-gray-500 mb-2 uppercase tracking-widest">// æ•°æ®è½½è·</label>
        <div class="relative">
          <textarea id="write-content" rows="3"
                          class="w-full bg-black border border-gray-700 p-3 text-green-400 focus:border-cyan-400 focus:ring-1 focus:ring-cyan-400 focus:outline-none transition-all font-mono text-sm"
                          placeholder="åœ¨æ­¤è¾“å…¥æ•°æ®...">Hello World</textarea>
          <!-- è£…é¥°æ€§çš„è§’æ ‡ -->
          <div class="absolute bottom-2 right-2 text-[10px] text-gray-600">è¾“å…¥æµ</div>
        </div>
      </div>

      <!-- æ“ä½œæŒ‰é’® -->
      <button id="toggle-btn"
                      class="w-full py-5 text-black font-black text-xl bg-cyan-400 hover:bg-white hover:shadow-[0_0_20px_rgba(0,243,255,0.6)] transition-all clip-corner glitch-hover uppercase tracking-widest">
        åˆå§‹åŒ–ç³»ç»Ÿ
      </button>
    </div>

    <!-- æ—¥å¿—åŒº -->
    <div class="border border-gray-800 bg-black p-4 h-48 overflow-y-auto font-mono text-xs relative">
      <div class="absolute top-0 right-0 bg-gray-800 text-white px-2 py-0.5 text-[10px]">ç³»ç»Ÿæ—¥å¿—</div>
      <div id="console-log" class="space-y-1">
        <!-- Log entries will appear here -->
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€çŠ¶æ€ç®¡ç†
    let isWriting = false;
    let abortController = null;
    let recordType = 'text'; // 'text' | 'url'
    let successCount = 0;

    // DOM å…ƒç´ å¼•ç”¨
    const statusCard = document.getElementById('status-card');
    const statusText = document.getElementById('status-text');
    const statusSub = document.getElementById('status-sub');
    const statusIcon = document.getElementById('status-icon');
    const loadingBar = document.getElementById('loading-bar');
    const toggleBtn = document.getElementById('toggle-btn');
    const logContainer = document.getElementById('console-log');
    const inputContent = document.getElementById('write-content');

    // --- å¯åŠ¨æ—¶ç«‹å³æ‰§è¡Œç¯å¢ƒè¯Šæ–­ ---
    window.addEventListener('load', () => {
      performSystemDiagnostics();
    });

    function performSystemDiagnostics() {
      log("> æ­£åœ¨å¼•å¯¼è‡ªæ£€åºåˆ—...", "info");

      // 1. æ£€æŸ¥æ˜¯å¦ä¸ºå®‰å…¨ä¸Šä¸‹æ–‡ (HTTPS/Localhost)
      if (!window.isSecureContext) {
        log("ä¸¥é‡é”™è¯¯: ä¸å®‰å…¨çš„ç¯å¢ƒ (Insecure Context)", "error");
        log(`å½“å‰åè®®: ${window.location.protocol}`, "warn");

        if (window.location.protocol === 'file:') {
          log("åŸå› : ä½ æ­£åœ¨ç›´æ¥æ‰“å¼€æœ¬åœ°æ–‡ä»¶ã€‚", "warn");
          log("è§£å†³: å¿…é¡»é€šè¿‡ HTTP Server è®¿é—® (å¦‚ VSCode Live Server)", "success");
        } else {
          log("åŸå› : å½“å‰è¿æ¥æœªä½¿ç”¨ HTTPSã€‚", "warn");
          log("è§£å†³: è¯·éƒ¨ç½²åˆ° GitHub Pages/Vercel æˆ–ä½¿ç”¨ Localhost", "success");
        }

        updateUIState('error');
        statusText.textContent = "ç¯å¢ƒä¸å®‰å…¨";
        statusSub.textContent = ">>> éœ€è¦ HTTPS æˆ– Localhost";
        toggleBtn.disabled = true;
        toggleBtn.textContent = "ç¯å¢ƒå—é™";
        toggleBtn.className = "w-full py-5 text-gray-500 bg-gray-800 border border-red-900 cursor-not-allowed clip-corner uppercase tracking-widest";
        return;
      }

      // 2. æ£€æŸ¥ NDEFReader æ”¯æŒ
      if (!("NDEFReader" in window)) {
        log("é”™è¯¯: æµè§ˆå™¨å†…æ ¸ä¸æ”¯æŒ Web NFC", "error");
        log(`UserAgent: ${navigator.userAgent}`, "warn");

        updateUIState('error');
        statusText.textContent = "ç¡¬ä»¶/å†…æ ¸ä¸æ”¯æŒ";
        statusSub.textContent = ">>> è¯·ç¡®è®¤ä½¿ç”¨ Chrome Android 89+";
        toggleBtn.disabled = true;
        toggleBtn.textContent = "ç»„ä»¶ç¼ºå¤±";
        toggleBtn.classList.add("opacity-50", "cursor-not-allowed");
        return;
      }

      // 3. ä¸€åˆ‡æ­£å¸¸
      log("è‡ªæ£€é€šè¿‡: HTTPS ç¯å¢ƒç¡®è®¤", "success");
      log("è‡ªæ£€é€šè¿‡: NDEF æ¨¡å—å°±ç»ª", "success");
      updateUIState('idle');
    }

    // ç±»å‹åˆ‡æ¢é€»è¾‘
    function setRecordType(type) {
      recordType = type;
      const btnText = document.getElementById('btn-type-text');
      const btnUrl = document.getElementById('btn-type-url');

      const activeClass = "border-cyan-400 text-cyan-400 bg-cyan-900/20";
      const inactiveClass = "border-gray-700 text-gray-500";

      if (type === 'text') {
        btnText.className = `flex-1 py-2 px-4 border transition-colors font-bold text-sm clip-corner ${activeClass}`;
        btnUrl.className = `flex-1 py-2 px-4 border transition-colors font-bold text-sm clip-corner hover:border-pink-500 hover:text-pink-500 ${inactiveClass}`;
        inputContent.placeholder = "è¾“å…¥æ–‡æœ¬æ•°æ®...";
      } else {
        btnText.className = `flex-1 py-2 px-4 border transition-colors font-bold text-sm clip-corner hover:border-pink-500 hover:text-pink-500 ${inactiveClass}`;
        btnUrl.className = `flex-1 py-2 px-4 border transition-colors font-bold text-sm clip-corner ${activeClass}`;
        inputContent.placeholder = "éœ€è¦ HTTPS:// åè®®é“¾æ¥";
      }
      log(`> åè®®å·²åˆ‡æ¢è‡³: ${type.toUpperCase()}`);
    }

    // æ ¸å¿ƒï¼šåˆ‡æ¢å†™å…¥çŠ¶æ€
    toggleBtn.addEventListener('click', async () => {
      if (!isWriting) {
        await startAutoWrite();
      } else {
        stopAutoWrite();
      }
    });

    // æ ¸å¿ƒï¼šè‡ªåŠ¨å†™å…¥å¾ªç¯é€»è¾‘
    async function startAutoWrite() {
      try {
        // å®ä¾‹åŒ–æ—¶å¯èƒ½ä¼šè¯·æ±‚æƒé™
        const ndef = new NDEFReader();

        log("> è¯·æ±‚ NFC ç¡¬ä»¶è®¿é—®æƒé™...");
        // å°è¯•ä¸€æ¬¡æ‰«ææ¥è§¦å‘æƒé™å¼¹çª—ï¼ˆå¦‚æœè¿˜æ²¡æˆæƒï¼‰
        await ndef.scan();

        isWriting = true;
        abortController = new AbortController();

        updateUIState('scanning');
        log("> è®¿é—®å·²æˆæƒã€‚åºåˆ—å·²å¯åŠ¨...", "success");

        while (isWriting) {
          try {
            const content = inputContent.value.trim();
            if (!content) {
              log("> è­¦å‘Š: æ•°æ®è½½è·ä¸ºç©ºã€‚æŒ‚èµ·ä¸­...", "warn");
              await delay(1000);
              continue;
            }

            const record = recordType === 'url'
              ? { recordType: "url", data: content }
              : { recordType: "text", data: content };

            // å…³é”®ï¼šsignal ç”¨äºä¸­æ–­æŒ‚èµ·çš„ write
            await ndef.write({ records: [record] }, { signal: abortController.signal });

            successCount++;
            updateUIState('success');
            log(`> [${successCount}] æ³¨å…¥æˆåŠŸ: ${content.substring(0, 15)}...`, "success");

            await delay(1500); // ç¨å¾®å¢åŠ å»¶è¿Ÿï¼Œé˜²æ­¢è¿‡å¿«

            if (isWriting) updateUIState('scanning');

          } catch (error) {
            if (error.name === 'AbortError') {
              log("> ç”¨æˆ·ä¸­æ­¢äº†åºåˆ—ã€‚");
              break;
            } else if (error.name === 'NotAllowedError') {
              log("> é”™è¯¯: NFC æƒé™è¢«æ‹’ç»", "error");
              log("> è¯·æ£€æŸ¥ç³»ç»Ÿè®¾ç½® -> åº”ç”¨æƒé™", "warn");
              stopAutoWrite();
              break;
            } else if (error.name === 'NotSupportedError') {
              log("> é”™è¯¯: æ ‡ç­¾ä¸æ”¯æŒæˆ– NFC å…³é—­", "error");
              log("> è¯·æ£€æŸ¥ä¸‹æ‹‰èœå• NFC æ˜¯å¦å¼€å¯", "warn");
              await delay(2000);
            } else {
              updateUIState('error');
              log(`> é”™è¯¯: ${error.message}`, "error");
              await delay(2000);
            }

            if (isWriting) updateUIState('scanning');
          }
        }

      } catch (error) {
        log(`> åˆå§‹åŒ–å¤±è´¥: ${error.message}`, "error");
        stopAutoWrite();
      }
    }

    function stopAutoWrite() {
      isWriting = false;
      if (abortController) {
        abortController.abort();
        abortController = null;
      }
      updateUIState('idle');
      log("> ç³»ç»Ÿå·²æŒ‚èµ·ã€‚");
    }

    function updateUIState(state) {
      statusCard.className = "cyber-card p-8 mb-6 text-center transition-all duration-300";
      loadingBar.className = "h-full w-0 transition-all duration-300";

      switch (state) {
        case 'idle':
          statusIcon.textContent = "ğŸ›‘";
          statusText.textContent = "ç³»ç»Ÿå¾…æœº";
          statusText.className = "text-2xl font-bold mb-2 text-white";
          statusSub.textContent = ">>> ç­‰å¾…æŒ‡ä»¤è¾“å…¥";
          statusSub.className = "text-xs text-gray-500 mt-3 font-bold uppercase tracking-widest";
          toggleBtn.textContent = "åˆå§‹åŒ–ç³»ç»Ÿ";
          toggleBtn.className = "w-full py-5 text-black font-black text-xl bg-cyan-400 hover:bg-white hover:shadow-[0_0_20px_rgba(0,243,255,0.6)] transition-all clip-corner glitch-hover uppercase tracking-widest";
          break;
        case 'scanning':
          statusCard.classList.add("state-scanning");
          statusCard.style.borderColor = "var(--neon-yellow)";
          statusIcon.textContent = "ğŸ“¡";
          statusText.textContent = "æ‰«æä¸­...";
          statusText.className = "text-2xl font-bold mb-2 text-yellow-400 text-glow";
          statusSub.textContent = ">>> è¯·é è¿‘ç›®æ ‡è®¾å¤‡";
          statusSub.className = "text-xs text-yellow-600 mt-3 font-bold uppercase tracking-widest animate-pulse";
          loadingBar.className = "h-full bg-yellow-400 w-full animate-pulse";
          toggleBtn.textContent = "ç»ˆæ­¢ç¨‹åº";
          toggleBtn.className = "w-full py-5 text-white font-black text-xl bg-pink-600 hover:bg-pink-500 hover:shadow-[0_0_20px_rgba(255,0,255,0.6)] transition-all clip-corner uppercase tracking-widest border border-pink-400";
          break;
        case 'success':
          statusCard.style.borderColor = "#00ff41";
          statusCard.style.boxShadow = "0 0 30px rgba(0, 255, 65, 0.2)";
          statusIcon.textContent = "ğŸ’¾";
          statusText.textContent = "å†™å…¥å®Œæˆ";
          statusText.className = "text-2xl font-bold mb-2 text-green-400 text-glow";
          statusSub.textContent = ">>> ç›®æ ‡å·²æ•è·";
          statusSub.className = "text-xs text-green-600 mt-3 font-bold uppercase tracking-widest";
          loadingBar.className = "h-full bg-green-500 w-full";
          if (navigator.vibrate) navigator.vibrate(50);
          break;
        case 'error':
          statusCard.style.borderColor = "var(--neon-pink)";
          statusCard.style.boxShadow = "0 0 20px rgba(255, 0, 255, 0.3)";
          statusIcon.textContent = "âš ï¸";
          statusText.textContent = "ç³»ç»Ÿå¼‚å¸¸";
          statusText.className = "text-2xl font-bold mb-2 text-pink-500 text-glow-pink";
          statusSub.textContent = ">>> æ£€æŸ¥æ—¥å¿—è¾“å‡º";
          statusSub.className = "text-xs text-pink-700 mt-3 font-bold uppercase tracking-widest";
          if (navigator.vibrate) navigator.vibrate([50, 50, 50]);
          break;
      }
    }

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    function log(msg, type = 'info') {
      const div = document.createElement('div');
      const time = new Date().toLocaleTimeString('zh-CN', { hour12: false });
      let prefix = "ä¿¡æ¯";
      let colorClass = "text-cyan-600";

      if (type === 'error') {
        prefix = "é”™è¯¯ ";
        colorClass = "text-pink-500 font-bold";
      } else if (type === 'warn') {
        prefix = "è­¦å‘Š";
        colorClass = "text-yellow-500";
      } else if (type === 'success') {
        prefix = "å®Œæˆ";
        colorClass = "text-green-400";
      }

      div.innerHTML = `<span class="text-gray-600">[${time}]</span> <span class="${colorClass}">${prefix}</span> :: ${msg}`;
      div.className = "hover:bg-gray-900 px-1 border-b border-gray-900";

      logContainer.appendChild(div);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
  </script>
</body>

</html>